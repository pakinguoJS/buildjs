// 加载库
var FS 		= require('fs');
var PATH 	= require('path');
var transport	= require('cmd-transport');
var uglify		= require('cmd-uglify');


// 读取配置
var config;
if(process.argv.length === 3){
	config		= require(process.argv[2]);
}else{
	config  	= require('./CONFIG.json');
}
var alias		= require(config.ALIAS);
var ignore		= require(config.IGNORE);


/**
 * 执行流程：
 * 1、copy：源项目文件，其中不包括源文件夹下的lib文件夹
 * 2、transport：覆盖掉cmd模块
 * 3、将step1未copy的文件夹再复制到transport之后的文件夹下
 * 4、uglify：合并压缩，以单一模块为单位（模块包括其依赖链），需要传入忽略合并的模块列表
 */
var s = new Date().getTime();

transport(config.TRANSPORTSRC, config.TRANSPORTDEST, alias, config.GRUNTJS, function(){
	uglify.uglifyTask(config.UGLIFYSRC, config.UGLIFYBASE, ignore, config.GRUNTJS, function(){
		console.log("============= Finish in: " + (new Date().getTime() - s) + " ms ==============");
	})
});