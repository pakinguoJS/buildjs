var FS = require('fs');

// 配置量
var OUTPUTPATH = './CONFIG.json';
var TIPS = [
	{
		key: 'CSSMINSRC',
		val: '1. Input your project path, which is the path of cssmin(like: /data/project/resource_dev): \n',
		def: './'
	},
	{
		key: 'CSSMINDEST',
		val: '2. Input your destination after cssmin, which is cleaned after transport(like: /data/project/resource_publish_temp): \n',
		def: './'
	},
	{
		key: 'CSSMINBASE',
		val: '3. Input your base path of seajs config(like: /front/en): \n',
		def: './'
	},
	{
		key: 'TRANSPORTSRC',
		val: '4. Input your project path, which is the path of transport(like(same as CSSMINDEST): /data/project/resource_publish_temp): \n',
		def: './'
	},
	{
		key: 'TRANSPORTDEST',
		val: '5. Input your destination after transport(like: /data/project/resource_publish): \n',
		def: './'
	},
	{
		key: 'UGLIFYSRC',
		val: '6. Input path list of directory required to uglify(like: /data/project/resource_publish/app, /data/project/resource_publish/widget): \n',
		def: './'
	},
	{
		key: 'UGLIFYBASE',
		val: '7. Input the base path of uglify directory(like: /data/project/resource_publish): \n',
		def: './'
	},
	{
		key: 'ALIAS',
		val: '8. Input the alias modules json file path(like: ./alias.json): \n',
		def: './alias.json'
	},
	{
		key: 'IGNORE',
		val: '9. Input the ignore modules json file path(like: ./ignore.json): \n',
		def: './ignore.json'
	},
	{
		key: 'GRUNTJS',
		val: '10. Input the gruntjs\'s path(default: ../gruntjs): \n',
		def: '../gruntjs'
	},
	{
		val: '11. Are you sure?(yes) '
	}
];
var idx = 0;
var end = TIPS.length - 1;
var packageJSON = {};


// dispose according to different args
var args = process.argv;
if(args.length > 2){
	if(args[2] === '-h' || args[2] === '-help'){
		console.log('NO HELP!');
		return;
	}else if(args[2] === '-a'){
		TIPS = [
			{
				key: 'CSSMINSRC',
				val: '1. Cssmin Source Path: \n',
				def: './'
			},
			{
				key: 'CSSMINDEST',
				val: '2. Cssmin Destination Path(temp): \n',
				def: './'
			},
			{
				key: 'CSSMINBASE',
				val: '3. Cssmin base of config: \n',
				def: './'
			},
			{
				key: 'TRANSPORTSRC',
				val: '4. Transport Source Path(same as CSSMINDEST): \n',
				def: './'
			},
			{
				key: 'TRANSPORTDEST',
				val: '5. Transport Destination Path: \n',
				def: './'
			},
			{
				key: 'UGLIFYSRC',
				val: '6. Ugilify Source Path: \n',
				def: './'
			},
			{
				key: 'UGLIFYBASE',
				val: '7. Ugilify Source Base Path: \n',
				def: './'
			},
			{
				key: 'ALIAS',
				val: '8. Alias File Path: \n',
				def: './alias.json'
			},
			{
				key: 'IGNORE',
				val: '9. Ignore File Path: \n',
				def: './ignore.json'
			},
			{
				key: 'GRUNTJS',
				val: '10. Gruntjs Tools Path: \n',
				def: '../gruntjs'
			},
			{
				val: '11. Are you sure?(yes) '
			}
		];
	}
}


// 逐一保存
process.stdin.setEncoding('utf8');
process.stdout.write(TIPS[idx].val);
process.stdin.on('readable', function() {
	// 转化为string
	var chunk = process.stdin.read();
	var str = new String(chunk).toString().replace(/\r\n|\r|\n/g, '');
	if(idx === end){
		if(str == 'yes' || str == 'y'){
			FS.writeFileSync(OUTPUTPATH, JSON.stringify(packageJSON), 'utf-8');
			process.stdout.write('[SUCCESS]: File "' + OUTPUTPATH + '" has been created!\n');
		}else{
			process.stdout.write('[FAIL]: You have canceled the process!\n');
		}
		
		process.exit(1);
	}else if(chunk !== null) {
		str = str.split(',');
		packageJSON[TIPS[idx].key] = str.length === 1 ? str[0] : str;
	}else if(chunk === null){
		return;
	}else{
		packageJSON[TIPS[idx].key] = packageJSON[TIPS[idx].def];
	}
	
	idx++;
	process.stdout.write(TIPS[idx].val);
});

process.stdin.on('end', function() {
	process.stdout.write('end');
});
