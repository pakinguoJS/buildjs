
define(function (require, exports, module) {

	var $ = require('jquery');
	require('bootstrap');
	require('../css/search-preview.css');

	$.fn.extend({

		searchPreview: function (options) {

			options = options || {};

			this.each(function (index, element) {
				
				if (!$(this).data('searchPreview')) {
					$(this).data('searchPreview', {});
					
					var items = $(this).find('li').map(function (index, element) {
						return {
							title: $(this).attr('data-title'),
							iconUrl: $(this).attr('data-icon-url')
						};
					});
					
					$(this)
						.addClass('search-preview')
						.empty()
						.append($('<div class="preview"></div>')
							.append($('<ul></ul>'))
						)
						.searchPreview().addItem(items);
				}
			});

			return {

				$this: this,

				clear: function () {

					this.$this.find('.preview > ul')
						.empty();

					return this.$this;
				},

				addItem: function (item) {

					var container = this.$this;

					$(item).each(function (index, item) {
						container.find('.preview > ul')
							.append($('<li class="clearfix"></li>')
								.data('searchPreview', {
									title: item.title,
									iconUrl: item.iconUrl
								})
								.append($('<img class="pull-left" src="' + item.iconUrl + '" alt="' + item.title + '" />'))
								.append($('<span class="arrow pull-right"></span>'))
								.append($('<p></p>')
									.html(item.title)
								)
							);
					});

					return this.$this;
				},

				getItemList: function () {

					return this.$this.find('.preview > ul > li').map(function (index, element) {
						return {
							title: $(this).data('searchPreview').title,
							iconUrl: $(this).data('searchPreview').iconUrl
						};
					}).get();
				}

			};
		}

	});

});