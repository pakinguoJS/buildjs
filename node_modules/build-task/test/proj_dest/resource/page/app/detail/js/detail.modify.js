define("page/app/detail/js/detail.modify",["lib/cmd/jquery/2.0.3/jquery.js","lib/cmd/swf/swfupload.js","page/widget/ivy_alert/js/ivy.alert.js","lib/cmd/jquery/validation/1.10.0/jquery.validate.min.js"],function(a){var b=a("lib/cmd/jquery/2.0.3/jquery.js"),c=a("lib/cmd/swf/swfupload.js"),d=a("page/widget/ivy_alert/js/ivy.alert.js");a("lib/cmd/jquery/validation/1.10.0/jquery.validate.min.js"),new c({upload_url:"/cms/index.php/upload/up2tfs",file_size_limit:"2 MB",file_types:"*.jpg;*.png;*.gif",file_types_description:"JPG/PNG/GIF Images",file_upload_limit:"0",file_queue_error_handler:function(a,b,d){switch(b){case c.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED:alert("Single image only!");break;case c.QUEUE_ERROR.ZERO_BYTE_FILE:alert("File size is 0!");break;case c.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT:alert("The image exceeds 2M.");break;case c.QUEUE_ERROR.INVALID_FILETYPE:alert("Image files can be .bmp, .png, .jpeg, .jpg or .gif");break;default:alert(d)}},file_dialog_complete_handler:function(a,b){b>0&&this.startUpload()},upload_progress_handler:function(){},upload_error_handler:function(a,b,c){d(c)},upload_success_handler:function(a,c){try{if(c=JSON.parse(c),0==c.ret){var e=b("#imgList").children(),f="";f=0===e.length?"first last":"last",e.last().removeClass("last"),b('<li class="{which}">                            <img src="{pic_url}" data-val="{pic_url}">                            <div class="covers_fns">                                <span class="cover" data-rel="cover" title="設置為封面">⊙</span>                                <span class="prev" data-rel="prev" title="前移"><<</span>                                <span class="next" data-rel="next" title="後移">>></span>                                <span class="del" data-rel="del" title="刪除">×</span>                            </div>                            <div class="covers_idx" data-rel="index">{index}</div>                        </li>'.replace("{which}",f).replace(/\{pic_url\}/g,c.data.pic_url).replace("{index}",e.length+1)).appendTo(b("#imgList")),d("Upload successfully!")}else d(c.msg)}catch(g){d(c)}},upload_complete_handler:function(){},button_placeholder_id:"upload",button_width:161,button_height:30,button_text_top_padding:5,button_window_mode:c.WINDOW_MODE.TRANSPARENT,button_cursor:c.CURSOR.HAND,wrapStyle:"position: relative;height: 30px;width: 160px;",objectStyle:"position: absolute;left: 0;z-index:9",btnElement:'<button type="button" class="btn-upload" style="position: absolute;z-index: 8">上傳圖片</button>',flash_url:"/cms/resource/lib/cmd/swf/swfupload.swf",debug:!1});var e={init:function(){this.sort(),this.delImg(),this.checkItem(),this.rating(),this.get2Region(),this.get2Dishes(),this.getLandmarkList(),this.addDiscount()},sort:function(){b("#imgList").delegate('span[data-rel="cover"]',"click",function(){var a=b(this).parent().parent(),c=a.parent().children().eq(0).find("img"),d=a.find("img");d.replaceWith(c.clone()),c.replaceWith(d)}),b("#imgList").delegate('span[data-rel="prev"]',"click",function(){var a=b(this).parent().parent(),c=a.prev();if(0!==c.length){var d=a.find("img"),e=c.find("img");d.replaceWith(e.clone()),e.replaceWith(d)}}),b("#imgList").delegate('span[data-rel="next"]',"click",function(){var a=b(this).parent().parent(),c=a.next();if(0!==c.length){var d=a.find("img"),e=c.find("img");d.replaceWith(e.clone()),e.replaceWith(d)}})},delImg:function(){b("#imgList").delegate('span[data-rel="del"]',"click",function(){var a=b(this).parent().parent(),c=a.parent(),d=c.children();0===d.index(a)?a.next().addClass("first"):d.index(a)===d.length-1&&a.prev().addClass("last"),a.remove(),d.each(function(a){b(this).find('div[data-rel="index"]').text(a+1)})})},getImgList:function(){var a=[];return b("#imgList").find("img").each(function(){a.push(b(this).attr("data-val"))}),0===a.length?!1:a},checkItem:function(){b("#checkType").change(function(){b.getJSON("/web/index.php/ipickweb/check_item",{restaurantid:b("#id").val(),type:this.checked?1:0},function(a){0==a.ret||alert(a.msg)})})},rating:function(){function a(a){var c=b(this).offset();b("#ratingShow").text(a).css({top:c.top-25,left:c.left+5}).fadeIn(300,function(){b(this).fadeOut(700)})}b('ul[data-rel="rating"]').children().hover(function(){var a=b(this),c=+a.attr("data-val");for(a=a.parent(),a=a.children().removeClass("active"),c--;c>-1;c--)a.eq(c).addClass("active")},function(){var a=b(this).parent(),c=+a.attr("data-val");for(a=a.children().removeClass("active"),c--;c>-1;c--)a.eq(c).addClass("active")}).on("click",function(){var c=b(this),d=c.parent(),e=d.children(),f=c.attr("data-val");b.getJSON("/cms/index.php/ipickweb/rating",{rating_score:f,restaurant_id:d.attr("data-id")},function(b){0==b.ret?(d.attr("data-val",f),a.call(c[0],"+"+f)):e.removeClass("active")})})},get2Region:function(){function a(a){for(var c="",d=0,e=a.length;e>d;d++)c+='<option value="'+a[d].id+'" data-name="'+a[d].name+'">'+a[d].name+"</option>";var f=b("#regionS");f.html(c),f.removeAttr("disabled"),f.attr("data-val")&&(f.children('[data-name="'+f.attr("data-val")+'"]').attr("selected",""),f.removeAttr("data-val"))}b("#regionF").change(function(){b("#regionS").attr("disabled",""),b.getJSON("/cms/index.php/region/get_region",{id:this.value},function(b){0==b.ret?b.data.data.region_list?a(b.data.data.region_list):null:d(b.msg)})}).change()},get2Dishes:function(){function a(a){for(var c="",d=0,e=a.length;e>d;d++)c+='<option value="'+a[d].id+'" data-name="'+a[d].name+'">'+a[d].name+"</option>";var f=b("#subTypeS");f.html(c),f.removeAttr("disabled"),f.attr("data-val")&&(f.children('[data-name="'+f.attr("data-val")+'"]').attr("selected",""),f.removeAttr("data-val"))}b("#subTypeF").change(function(){b("#subTypeS").attr("disabled",""),b.getJSON("/cms/index.php/cuisine/get_cuisine",{id:this.value},function(b){0==b.ret?b.data.data.cuisine_list?a(b.data.data.cuisine_list):null:d(b.msg)})}).change()},getLandmarkList:function(){function a(a){for(var c="",d=0,e=a.length;e>d;d++)c+='<li data-val="'+a[d].id+'">'+a[d].name+"</li>";b("#landmarkList").html(c)}b("#addLandmark").click(function(){b("#landmarkItem").children().clone().appendTo(b("#formLandmarkList"))});var c=null;b("#formLandmarkList").delegate('input[data-rel="landmark"]',"click focus",function(){b("#landmarkShow").show(),c=this}),b("#formLandmarkList").delegate('a[data-rel="landmark_item_del"]',"click",function(){b(this).parent().remove()}),b("#landmarkSearch").next().click(function(){var c=b.trim(b(this).prev().val());c&&b.getJSON("/cms/index.php/landmark/search",{keyword:c},function(b){0==b.ret?b.data.data.all_list&&b.data.data.all_list.length>0?a(b.data.data.all_list):d("無數據！"):d(b.msg)})}),b("#landmarkList").delegate("li","click",function(){var a=b(this);b(c).val(a.text()).next().val(a.attr("data-val")),b("#landmarkShow").hide()}),b("#landmarkClose").click(function(){b("#landmarkShow").hide()})},getLandmarkData:function(){var a=[];return b('input[data-name="landmark"]').each(function(){this.value&&a.push(this.value)}),a},addDiscount:function(){function a(a){if(!a)return"";for(var b='<option value="{v}">{v}</option>',c="",d=0,e=a.length;e>d;d++)c+=b.replace(/{v}/g,a[d]);return'<option value="">---</option>'+c}function c(a){if(!a)return"";var b='<option value="{val}">{txt}</option>',c="";for(var d in a)c+=b.replace(/{val}/,d).replace(/{txt}/,a[d]);return c}b("#discountFL").change(function(){""!==this.value&&(b("#discountSL, #discountTL").children().remove(),b.getJSON("/cms/index.php/discount/get_bank_type_list",{bank_name:b(this).val()},function(c){0===c.ret?(b("#discountSL, #discountTL").children().remove(),b("#discountSL").html(a(c.data.card_list))):d(c.msg)}))}),b("#discountSL").change(function(){""!==this.value&&b.getJSON("/cms/index.php/discount/get_discount_list",{bank_name:b("#discountFL").val(),card_type:b(this).val()},function(a){0===a.ret?(b("#discountTL").children().remove(),b("#discountTL").html(c(a.data.discount_list))):d(a.msg)})}),b("#addDiscount").click(function(){var a='<li>                                <p>{bank}<strong>|</strong>{card}<strong>|</strong>{discount}</p>                                <input type="hidden" value="{val}"/>                                <a href="javascript:void(0)" data-rel="discount-remove"><span class="glyphicon glyphicon-remove-circle"></span></a>                            </li>';b(a.replace("{bank}",b("#discountFL").val()).replace("{card}",b("#discountSL").val()).replace("{discount}",b("#discountTL").children('[value="'+b("#discountTL").val()+'"]').text()).replace("{val}",b("#discountTL").val())).appendTo(b("#discountList"))}),b("#discountList").delegate('a[data-rel="discount-remove"]',"click",function(){b(this).parent().remove()})},getDiscountData:function(){var a=[];return b("#discountList").children().each(function(){a.push(b(this).find("input").val())}),0===a.length?"":JSON.stringify(a)}};e.init(),b("#restaurant-register-form").validate({rules:{tel:{required:!0}},errorElement:"span",errorPlacement:function(a,b){b.parent().find('[data-control="form-input-error"]').append(a)},submitHandler:function(a){var c=e.getImgList();return c?void b.post("/cms/index.php/ipickweb/do_modify",{cms_id:a.cms_id.value,cuisine_id:b("#subTypeS").val(),region_id:b("#regionS").val(),landmark_id:JSON.stringify(e.getLandmarkData()),spendingvalue:a.spendingvalue.value,restaurantid:a.id.value,picture_list:JSON.stringify(c),phone:a.phone.value,location:a.location.value,direction:a.direction.value,openinghours:JSON.stringify({openinghour1:a.openinghour1.value,openinghour2:a.openinghour2.value,openinghour3:a.openinghour3.value,openinghour4:a.openinghour4.value,openinghour5:a.openinghour5.value,openinghour6:a.openinghour6.value,openinghour7:a.openinghour7.value}),discount:e.getDiscountData()},function(a){0==a.ret&&d(a.msg,function(){history.go(-1)})},"json"):void alert("至少需要一張图片！")}}),b("#navBar").css({right:(b(window).width()-980)/2-100-20}),b(window).scroll(function(){b(this).scrollTop()>0?b("#scrollToTop").fadeIn(250):b("#scrollToTop").fadeOut(500)}),b("#scrollToTop").click(function(){b(window).scrollTop(0)})}),define("page/widget/ivy_alert/js/ivy.alert",["page/widget/ivy_alert/css/ivy.alert.css","page/widget/ivy_alert/template/tpl.ivy.alert.js"],function(a,b,c){function d(a,b){h.find("#ivyAlertMain").text(a),b?null:b={},e(b),clearTimeout(g),b.toggle||(g=setTimeout(function(){f(),"function"==typeof b?b():"function"==typeof b.callback?b.callback():null},"number"==typeof b?b:b.duration?b.duration:i.duration))}function e(a){h.appendTo($("body")),setTimeout(function(){a.top?h.find("#ivyAlertMain").parent().css("top",a.top):h.find("#ivyAlertMain").parent().css("top",i.top),a.useMask?h.find("#ivyAlertMask").show():i.useMask?h.find("#ivyAlertMask").show():h.find("#ivyAlertMask").hide(),h.fadeIn(200)},20)}function f(){h.fadeOut(100,function(){h.detach()})}a("page/widget/ivy_alert/css/ivy.alert.css");var g,h=$(a("page/widget/ivy_alert/template/tpl.ivy.alert.js")),i={duration:1500,top:120,useMask:!0,callback:null};d.config=function(a){$.extend(i,a)},c.exports=d}),define("page/widget/ivy_alert/css/ivy.alert.css",[],function(){seajs.importStyle(".ivy-alert-wrap{position:fixed;top:0;left:0;width:100%;height:100%;z-index:1000;display:none}.ivy-alert{position:relative;margin:0 auto;min-height:50px;max-width:600px;text-align:center;top:120px}.ivy-alert-mask{position:absolute;top:0;left:0;width:100%;height:100%;background-color:rgba(255,255,255,.5);z-index:1001}.ivy-alert-main{position:relative;display:inline-block;font-size:14px;font-weight:700;color:#42484d;padding:16px 30px;background-color:#fff;border:1px solid #e15c4d;border-radius:3px;box-shadow:1px 1px 3px rgba(0,0,0,.35);z-index:1002}")}),define("page/widget/ivy_alert/template/tpl.ivy.alert",[],'<div class="ivy-alert-wrap">    <div id="ivyAlertMask" class="ivy-alert-mask"></div>    <div class="ivy-alert">        <p id="ivyAlertMain" class="ivy-alert-main"></p>    </div></div>');