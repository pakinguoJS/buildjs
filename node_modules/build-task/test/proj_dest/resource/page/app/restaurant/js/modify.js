define("page/app/restaurant/js/modify",["lib/cmd/jquery/2.0.3/jquery.js","page/widget/ivy_alert/js/ivy.alert.js","lib/cmd/jquery/validation/1.10.0/jquery.validate.min.js","lib/cmd/bootstrap/3.2.0/js/bootstrap.min.js","lib/cmd/select2/3.5.1/select2.js"],function(a){function b(a){var b={};return e(a).parent().find("input, textarea").each(function(a,c){var d=e(c).data("lang"),f=e(c).val();b[d]=f}),JSON.stringify(b)}function c(a){return e(a||[]).map(function(a,b){return{id:JSON.stringify({id:b.id,name:b.name}),text:b.name}})}function d(a){return e(a.split("##")).map(function(a,b){return b?JSON.parse(b):"[]"})}var e=a("lib/cmd/jquery/2.0.3/jquery.js"),f=a("page/widget/ivy_alert/js/ivy.alert.js");a("lib/cmd/jquery/validation/1.10.0/jquery.validate.min.js"),a("lib/cmd/bootstrap/3.2.0/js/bootstrap.min.js"),a("lib/cmd/select2/3.5.1/select2.js");var g={edit:function(){this.get2Cuisine(),this.get2Region(),this.getLandmarkList(),this.addDiscount()},list:function(){this.bindListAction()},get2Cuisine:function(){function a(a){for(var b="",c=0,d=a.length;d>c;c++)b+='<option value="'+a[c].id+'" data-name="'+a[c].name+'">'+a[c].name+"</option>";var f=e("#subTypeS");f.html(b),f.removeAttr("disabled"),f.attr("data-val")&&(f.children('[data-name="'+f.attr("data-val")+'"]').attr("selected",""),f.removeAttr("data-val"))}e("#subTypeF").change(function(){e("#subTypeS").attr("disabled",""),e.getJSON("/cms/index.php/cuisine/get_cuisine",{id:this.value},function(b){0==b.ret?b.data.data.cuisine_list?a(b.data.data.cuisine_list):null:f(b.msg)})}).change()},get2Region:function(){function a(a){for(var b="",c=0,d=a.length;d>c;c++)b+='<option value="'+a[c].id+'" data-name="'+a[c].name+'">'+a[c].name+"</option>";var f=e("#regionS");f.html(b),f.removeAttr("disabled"),f.attr("data-val")&&(f.children('[data-name="'+f.attr("data-val")+'"]').attr("selected",""),f.removeAttr("data-val"))}e("#regionF").change(function(){e("#regionS").attr("disabled",""),e.getJSON("/cms/index.php/region/get_region",{id:this.value},function(b){0==b.ret?b.data.data.region_list?a(b.data.data.region_list):null:f(b.msg)})}).change()},addDiscount:function(){function a(a){if(!a)return"";for(var b='<option value="{v}">{v}</option>',c="",d=0,e=a.length;e>d;d++)c+=b.replace(/{v}/g,a[d]);return'<option value="">---</option>'+c}function b(a){if(!a)return"";var b='<option value="{val}">{txt}</option>',c="";for(var d in a)c+=b.replace(/{val}/,d).replace(/{txt}/,a[d]);return c}e("#discountFL").change(function(){""!==this.value&&(e("#discountSL, #discountTL").children().remove(),e.getJSON("/cms/index.php/discount/get_bank_type_list",{bank_name:e(this).val()},function(b){0===b.ret?(e("#discountSL, #discountTL").children().remove(),e("#discountSL").html(a(b.data.card_list))):f(b.msg)}))}),e("#discountSL").change(function(){""!==this.value&&e.getJSON("/cms/index.php/discount/get_discount_list",{bank_name:e("#discountFL").val(),card_type:e(this).val()},function(a){0===a.ret?(e("#discountTL").children().remove(),e("#discountTL").html(b(a.data.discount_list))):f(a.msg)})}),e("#addDiscount").click(function(){if(e("#discountFL").val()&&e("#discountSL").val()&&e("#discountTL").val()){var a='<div class="alert alert-success alert-dismissible" role="alert" style="margin-bottom:5px;padding: 5px 35px 5px 15px;">                                <button type="button" class="close" data-dismiss="alert">                                    <input type="hidden" value="{val}"/>                                    <span aria-hidden="true">&times;</span>                                    <span class="sr-only" data-rel="discount-remove">Close</span>                                </button>                                <small><span class="glyphicon glyphicon-tags"></span> {bank}<strong>|</strong>{card}<strong>|</strong>{discount}</small>                            </div>';e(a.replace("{bank}",e("#discountFL").val()).replace("{card}",e("#discountSL").val()).replace("{discount}",e("#discountTL").children('[value="'+e("#discountTL").val()+'"]').text()).replace("{val}",e("#discountTL").val())).appendTo(e("#discountList"))}}),e("#discountList").delegate('a[data-rel="discount-remove"]',"click",function(){e(this).parent().remove()})},getDiscountData:function(){var a=[];return e("#discountList").children().each(function(){a.push(e(this).find("input").val())}),0===a.length?"":JSON.stringify(a)},getLandmarkList:function(){e("#landmark").select2({multiple:!0,separator:"##",minimumInputLength:1,formatInputTooShort:"Please enter the landmark",initSelection:function(a,b){a.val(""),b(c(JSON.parse(e("#landmarkids").val())))},ajax:{url:"/cms/index.php/landmark/search",data:function(a){return{keyword:a}},results:function(a){return{results:c(a.data.data.all_list)}}}}).on("change",function(){e("#landmarkids").val(JSON.stringify(d(e("#landmark").val()).get()))})},getLandmarkData:function(){for(var a=[],b=JSON.parse(e("#landmarkids").val()),c=0;c<b.length;c++)a.push(b[c].id);return a},bindListAction:function(){e(".btn_commit").click(function(){var a=e(this).attr("data-val");e.post("/cms/index.php/restaurant/push_rest",{id:a},function(a){a.ret},"json")})}};e("#restaurant-register-form").validate({rules:{},errorElement:"span",errorPlacement:function(a,b){b.parent().find('[data-control="form-input-error"]').append(a)},submitHandler:function(a){e.post("/cms/index.php/restaurant/do_register",{cms_id:a.cms_id.value,name:b("#i18n-name"),alias_name:b("#i18n-alias-name"),region_id:e("#regionS").val(),address:b("#i18n-location"),cuisine_id:e("#subTypeS").val(),search_tags:b("#i18n-location"),search_tags_alias:b("#i18n-search-tags-alias"),display_tags:b("#i18n-display-tags"),landmark_id:JSON.stringify(g.getLandmarkData()),lat:e("#lat").val(),lon:e("#lon").val(),direction:b("#i18n-direction"),award:b("#i18n-award"),discount:g.getDiscountData(),average_spending:a.spendingvalue.value,tel:a.phone.value,restaurantid:a.id.value,opening_hour1:a.openinghour1.value,opening_hour2:a.openinghour2.value,opening_hour3:a.openinghour3.value,opening_hour4:a.openinghour4.value,opening_hour5:a.openinghour5.value,opening_hour6:a.openinghour6.value,opening_hour7:a.openinghour7.value,description:b("#i18n-description")},function(a){a.ret?(e("#error-message").html("Sorry, your submission failed. Please try again."),e("#error-message").removeClass("hidden")):(e("#article-id").val(),e("#success-message").html("Your edit has been submitted."),e("#success-message").removeClass("hidden"),setTimeout(function(){location.href="/cms/index.php/rest_verify/index"},2e3))},"json")}}),g.edit()}),define("page/widget/ivy_alert/js/ivy.alert",["page/widget/ivy_alert/css/ivy.alert.css","page/widget/ivy_alert/template/tpl.ivy.alert.js"],function(a,b,c){function d(a,b){h.find("#ivyAlertMain").text(a),b?null:b={},e(b),clearTimeout(g),b.toggle||(g=setTimeout(function(){f(),"function"==typeof b?b():"function"==typeof b.callback?b.callback():null},"number"==typeof b?b:b.duration?b.duration:i.duration))}function e(a){h.appendTo($("body")),setTimeout(function(){a.top?h.find("#ivyAlertMain").parent().css("top",a.top):h.find("#ivyAlertMain").parent().css("top",i.top),a.useMask?h.find("#ivyAlertMask").show():i.useMask?h.find("#ivyAlertMask").show():h.find("#ivyAlertMask").hide(),h.fadeIn(200)},20)}function f(){h.fadeOut(100,function(){h.detach()})}a("page/widget/ivy_alert/css/ivy.alert.css");var g,h=$(a("page/widget/ivy_alert/template/tpl.ivy.alert.js")),i={duration:1500,top:120,useMask:!0,callback:null};d.config=function(a){$.extend(i,a)},c.exports=d}),define("page/widget/ivy_alert/css/ivy.alert.css",[],function(){seajs.importStyle(".ivy-alert-wrap{position:fixed;top:0;left:0;width:100%;height:100%;z-index:1000;display:none}.ivy-alert{position:relative;margin:0 auto;min-height:50px;max-width:600px;text-align:center;top:120px}.ivy-alert-mask{position:absolute;top:0;left:0;width:100%;height:100%;background-color:rgba(255,255,255,.5);z-index:1001}.ivy-alert-main{position:relative;display:inline-block;font-size:14px;font-weight:700;color:#42484d;padding:16px 30px;background-color:#fff;border:1px solid #e15c4d;border-radius:3px;box-shadow:1px 1px 3px rgba(0,0,0,.35);z-index:1002}")}),define("page/widget/ivy_alert/template/tpl.ivy.alert",[],'<div class="ivy-alert-wrap">    <div id="ivyAlertMask" class="ivy-alert-mask"></div>    <div class="ivy-alert">        <p id="ivyAlertMain" class="ivy-alert-main"></p>    </div></div>');