define("page/app/restaurant/js/verify_modify",["lib/cmd/jquery/2.0.3/jquery.js","page/widget/ivy_alert/js/ivy.alert.js","lib/cmd/jquery/validation/1.10.0/jquery.validate.min.js","lib/cmd/bootstrap/3.2.0/js/bootstrap.min.js","lib/cmd/select2/3.5.1/select2.js"],function(a){function b(a){return d(a||[]).map(function(a,b){return{id:JSON.stringify({id:b.id,name:b.name}),text:b.name}})}function c(a){return d(a.split("##")).map(function(a,b){return b?JSON.parse(b):"[]"})}var d=a("lib/cmd/jquery/2.0.3/jquery.js"),e=a("page/widget/ivy_alert/js/ivy.alert.js");a("lib/cmd/jquery/validation/1.10.0/jquery.validate.min.js"),a("lib/cmd/bootstrap/3.2.0/js/bootstrap.min.js"),a("lib/cmd/select2/3.5.1/select2.js");var f={edit:function(){this.get2Cuisine(),this.get2Region(),this.getLandmarkList(),this.addDiscount()},list:function(){this.bindListAction()},get2Cuisine:function(){function a(a){for(var b="",c=0,e=a.length;e>c;c++)b+='<option value="'+a[c].id+'" data-name="'+a[c].name+'">'+a[c].name+"</option>";var f=d("#subTypeS");f.html(b),f.attr("data-val")&&(f.children('[data-name="'+f.attr("data-val")+'"]').attr("selected",""),f.removeAttr("data-val"))}d("#subTypeF").change(function(){d("#subTypeS").attr("disabled",""),d.getJSON("/cms/index.php/cuisine/get_cuisine",{id:this.value},function(b){0==b.ret?b.data.data.cuisine_list?a(b.data.data.cuisine_list):null:e(b.msg)})}).change()},get2Region:function(){function a(a){for(var b="",c=0,e=a.length;e>c;c++)b+='<option value="'+a[c].id+'" data-name="'+a[c].name+'">'+a[c].name+"</option>";var f=d("#regionS");f.html(b),f.attr("data-val")&&(f.children('[data-name="'+f.attr("data-val")+'"]').attr("selected",""),f.removeAttr("data-val"))}d("#regionF").change(function(){d("#regionS").attr("disabled",""),d.getJSON("/cms/index.php/region/get_region",{id:this.value},function(b){0==b.ret?b.data.data.region_list?a(b.data.data.region_list):null:e(b.msg)})}).change()},addDiscount:function(){function a(a){if(!a)return"";for(var b='<option value="{v}">{v}</option>',c="",d=0,e=a.length;e>d;d++)c+=b.replace(/{v}/g,a[d]);return'<option value="">---</option>'+c}function b(a){if(!a)return"";var b='<option value="{val}">{txt}</option>',c="";for(var d in a)c+=b.replace(/{val}/,d).replace(/{txt}/,a[d]);return c}d("#discountFL").change(function(){""!==this.value&&(d("#discountSL, #discountTL").children().remove(),d.getJSON("/cms/index.php/discount/get_bank_type_list",{bank_name:d(this).val()},function(b){0===b.ret?(d("#discountSL, #discountTL").children().remove(),d("#discountSL").html(a(b.data.card_list))):e(b.msg)}))}),d("#discountSL").change(function(){""!==this.value&&d.getJSON("/cms/index.php/discount/get_discount_list",{bank_name:d("#discountFL").val(),card_type:d(this).val()},function(a){0===a.ret?(d("#discountTL").children().remove(),d("#discountTL").html(b(a.data.discount_list))):e(a.msg)})}),d("#addDiscount").click(function(){var a='<div class="alert alert-success alert-dismissible" role="alert" style="margin-bottom:5px;padding: 5px 35px 5px 15px;">                                <button type="button" class="close" data-dismiss="alert">                                    <input type="hidden" value="{val}"/>                                    <span aria-hidden="true">&times;</span>                                    <span class="sr-only" data-rel="discount-remove">Close</span>                                </button>                                <small><span class="glyphicon glyphicon-tags"></span> {bank}<strong>|</strong>{card}<strong>|</strong>{discount}</small>                            </div>';d(a.replace("{bank}",d("#discountFL").val()).replace("{card}",d("#discountSL").val()).replace("{discount}",d("#discountTL").children('[value="'+d("#discountTL").val()+'"]').text()).replace("{val}",d("#discountTL").val())).appendTo(d("#discountList"))}),d("#discountList").delegate('a[data-rel="discount-remove"]',"click",function(){d(this).parent().remove()})},getDiscountData:function(){var a=[];return d("#discountList").children().each(function(){a.push(d(this).find("input").val())}),0===a.length?"":JSON.stringify(a)},getLandmarkList:function(){d("#landmark").select2({multiple:!0,separator:"##",minimumInputLength:1,formatInputTooShort:"Please enter the landmark",initSelection:function(a,c){a.val(""),c(b(JSON.parse(d("#landmarkids").val())))},ajax:{url:"/cms/index.php/landmark/search",data:function(a){return{keyword:a}},results:function(a){return{results:b(a.data.data.all_list)}}}}).on("change",function(){d("#landmarkids").val(JSON.stringify(c(d("#landmark").val()).get()))})},getLandmarkData:function(){for(var a=[],b=JSON.parse(d("#landmarkids").val()),c=0;c<b.length;c++)a.push(b[c].id);return a},bindListAction:function(){d(".btn_commit").click(function(){var a=d(this).attr("data-val");d.post("/cms/index.php/restaurant/push_rest",{id:a},function(a){a.ret},"json")})}};d("#restaurant-register-form").validate({rules:{},errorElement:"span",errorPlacement:function(){},submitHandler:function(a){e("Loading...",{toggle:!0});var b={id:a.id.value,type:d("#status > label.active > input").val(),weight:d("#weight").val(),editorial_weight:d("#editorial_weight").val(),description:a.desc.value};return b.type?void d.post("/cms/index.php/rest_verify/approval",b,function(a){0==a.ret?e(a.msg,function(){location.href="/cms/index.php/rest_verify/index"}):e(a.msg)},"json"):void e("Need review status")}}),f.edit()}),define("page/widget/ivy_alert/js/ivy.alert",["page/widget/ivy_alert/css/ivy.alert.css","page/widget/ivy_alert/template/tpl.ivy.alert.js"],function(a,b,c){function d(a,b){h.find("#ivyAlertMain").text(a),b?null:b={},e(b),clearTimeout(g),b.toggle||(g=setTimeout(function(){f(),"function"==typeof b?b():"function"==typeof b.callback?b.callback():null},"number"==typeof b?b:b.duration?b.duration:i.duration))}function e(a){h.appendTo($("body")),setTimeout(function(){a.top?h.find("#ivyAlertMain").parent().css("top",a.top):h.find("#ivyAlertMain").parent().css("top",i.top),a.useMask?h.find("#ivyAlertMask").show():i.useMask?h.find("#ivyAlertMask").show():h.find("#ivyAlertMask").hide(),h.fadeIn(200)},20)}function f(){h.fadeOut(100,function(){h.detach()})}a("page/widget/ivy_alert/css/ivy.alert.css");var g,h=$(a("page/widget/ivy_alert/template/tpl.ivy.alert.js")),i={duration:1500,top:120,useMask:!0,callback:null};d.config=function(a){$.extend(i,a)},c.exports=d}),define("page/widget/ivy_alert/css/ivy.alert.css",[],function(){seajs.importStyle(".ivy-alert-wrap{position:fixed;top:0;left:0;width:100%;height:100%;z-index:1000;display:none}.ivy-alert{position:relative;margin:0 auto;min-height:50px;max-width:600px;text-align:center;top:120px}.ivy-alert-mask{position:absolute;top:0;left:0;width:100%;height:100%;background-color:rgba(255,255,255,.5);z-index:1001}.ivy-alert-main{position:relative;display:inline-block;font-size:14px;font-weight:700;color:#42484d;padding:16px 30px;background-color:#fff;border:1px solid #e15c4d;border-radius:3px;box-shadow:1px 1px 3px rgba(0,0,0,.35);z-index:1002}")}),define("page/widget/ivy_alert/template/tpl.ivy.alert",[],'<div class="ivy-alert-wrap">    <div id="ivyAlertMask" class="ivy-alert-mask"></div>    <div class="ivy-alert">        <p id="ivyAlertMain" class="ivy-alert-main"></p>    </div></div>');