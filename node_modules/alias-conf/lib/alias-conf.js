var FS = require('fs');
var PATH = require('path');
var mkdir = require('util-mkdir');


module.exports = setAlias;


function setAlias(tpl, dest, jsalias, cssalias, jsreg, cssreg){
	if(arguments.length < 2){
		console.log('SetAlias function is required at least 2 paramters!');
		return;
	}
	try{
		jsreg ? null : jsreg = /('|")\{seajs_alias\}('|")/;
		cssreg ? null : cssreg = /('|")\{seacss_alias\}('|")/;

		// make sure file is existed
		if(!FS.existsSync(dest)){
			mkdir(PATH.dirname(dest));
			FS.writeFileSync(dest, '', 'utf-8');
		}
		
		var data = FS.readFileSync(tpl, 'utf-8').replace(jsreg, jsalias ? FS.readFileSync(jsalias, 'utf-8') : '');
		data = data.replace(cssreg, cssalias ? FS.readFileSync(cssalias, 'utf-8') : '');
		
		if(data !== FS.readFileSync(dest, 'utf-8')){
			FS.writeFileSync(dest, data, 'utf-8');
		}
	}catch(e){
		throw(e);
	}
}